# 第九章 vim程序编辑器


<!-- vim-markdown-toc Redcarpet -->
* [vi的使用](#vi的使用)
    * [按键说明](#按键说明)
        * [一般指令模式下的按钮说明](#一般指令模式下的按钮说明)
        * [一般指令模式切换到编辑模式的可用按钮](#一般指令模式切换到编辑模式的可用按钮)
        * [一般指令模式切换到命令行界面的的可用按钮](#一般指令模式切换到命令行界面的的可用按钮)
    * [vim的暂存盘 救援回复与打开时的警告](#vim的暂存盘-救援回复与打开时的警告)
* [vim的额外功能](#vim的额外功能)
    * [区块选择](#区块选择)
    * [多文件编辑](#多文件编辑)
    * [多窗口功能](#多窗口功能)
    * [提示补全功能](#提示补全功能)
    * [vim环境配置与记录](#vim环境配置与记录)
* [其他vim注意事项](#其他vim注意事项)
    * [中文编码问题](#中文编码问题)
    * [Dos与Linux换行符](#dos与linux换行符)
    * [编码转换指令-iconv](#编码转换指令-iconv)

<!-- vim-markdown-toc -->

## vi的使用

vi共分为三种模式，分别是：
- 一般指令模式
  刚打开文件时，进入的就是一般指令模式。此模式中，可以使用上下左右来移动光标，可以使用字母命令来做各种排版等的事情。其他模式中按Esc来回到这个模式
- 编辑模式
  在一般指令模式下，输入“i,I,o,O,a,A,r,R”进入编辑模式，此时才可以编辑内容
- 命令行命令模式
  一般模式中，输入“: / ?"来进入

---

### 按键说明

#### 一般指令模式下的按钮说明

- 移动光标的方法

|h或左方向键|光标向左移动一个字符|
|j或下方向键|光标向下移动一个字符|
|k或上方向键|光标向上移动一个字符|
|l或右方向键|光标向右移动一个字符|

当先输入数字n然后按键的时候，就是移动n个字符的意思。其他许多指令都有类似功能，重复n次。

|[Ctrl]+f|向下移动一页，相当于[Page Down]|
|[Ctrl]+b|向上移动一页，相当于[Page Up]|
|[Ctrl]+d|向下移动半页|
|[Ctrl]+u|向上移动半页|
|+|光标移动到非空白字符的下一列|
|-|光标移动到非空白字符的上一列|
|*n*<space>|n是数字，表示光标向右移动n个字符|
|0或[Home]|光标移动到当前列的第一个字符|
|$或[End]|光标移动到当前列的最后一个字符|
|H|光标移动到当前屏幕第一列的第一个字符|
|M|光标移动到当前屏幕中央列的第一个字符|
|L|光标移动到当前屏幕最后一列的第一个字符|
|G|光标移动到文件的最后一列|
|*n*G|光标移动到第n列|
|gg|光标移动到第一列|

- 搜寻与取代

|/*word*|往下寻找word|
|?*word*|往上寻找word|
|n|重复上一个搜索动作，继续往下或往上寻找word|
|N|反向进行上一个搜索动作，往回找上一个word|
|:*n1*,*n2*s/*word1*/*word2*/g|n1和n2位数字，在n1和n2列之间寻找word1，并替换为word2|
|:1,$s/*word1*/*word2*/gc|从第一列到最后一列寻找word1，并替换为word2，在替换前需要用户确认|
|x,X|x删除后一个字符，X删除前一个字符|
|nx|删除后面n个字符|
|dd|删除光标所在列|
|ndd|删除光标所在的列及向下n列|
|d1G|删除光标所在到第一列的所有数据|
|dG|删除光标所在到最后一列的所有数据|
|d$|删除光标所在位置到当前列的最后一个字符|
|d0|删除光标所在位置到该列第一个字符|
|yy|复制光标所在列|
|nyy|复制光标所在的及往下n列|
|y1G|复制光标所在列到第一列的所有数据|
|yG|复制光标所在列到最后一列的所有数据|
|y0|复制光标所在位置到该行第一个字符的数据|
|y$|复制光标所在位置到该行最后一个字符的数据|
|p,P|p把已复制数据粘贴在光标所在列的下一列，P则在上一列|
|J|将光标所在列和下一列数据结合成一列|
|c|重复删除多个数据|
|u|撤销|
|[Ctrl]+r|重做|
|.|重复上一个动作|

#### 一般指令模式切换到编辑模式的可用按钮

|i,I|进入插入模式。i为在光标所在处插入，I为在该列的第一个非空白字符处插入|
|a,A|进入插入模式。a为在光标所在的下一个字符处插入，A为该列最后一个字符处后插入|
|o,O|进入插入模式。o为在当前光标所在列的下一列处插入一列，O为在上一行插入一列|
|r,R|进入替换模式。r取代当前字符一次，R取代光标文字，直到按下ESC|
|[ESC]|退出编辑模式，回到一般指令模式|

#### 一般指令模式切换到命令行界面的的可用按钮

|:w|保存文件|
|:w!|若文件为只读，强行写入，但权限不足时无法写入|
|:q|离开vi|
|:q!|不保存并离开|

!在vi中，意味强制执行

|ZZ|若文件没改动，则直接离开，若改动了，则保存后离开|
|:w [*filename*]|保存为filename的新文件|
|:r [*filename*]|读取文件名为filename的文件的数据到光标所在列的后面|
|:n1,n2 w [*filename*]|将n1行到n2行的内容储存为filename文件|
|:! command|暂时离开vi，执行command命令|
|:set nu|设置显示行号|
|:set nonu|取消设置显示行号|

vi中，数字通常代表重复做几次、或到第几个字符等的意思，具体看命令是干什么的。

### vim的暂存盘 救援回复与打开时的警告

当系统出现某些原因死机，异常退出vim程序时，可以通过vim的暂存的swp文件恢复未保存的记录。



vim会在编辑文件的目录下，创建一个.filename.swp文件。异常退出后再次打开时，会有警告信息，当已经有人在编辑一个文件的时候，第二个人打开也会弹出警告。有如下选项可以继续：
- [O]pen Read-Only：打开为只读文件
- [E]dit anyway：正常打开文件编辑
- [R]ecover：使用swp文件恢复未保存的内容
- [D]elete it：删除swp文件
- [Q]uit：离开vim
- [A]bort：忽略本次编辑，回到命令行，类似Quit。

注意，若不下达删除指令，暂存文件会一直保留。

---

## vim的额外功能

vim比vi，多了语法高亮、下面一行显示文件属性和光标位置等等功能。比vi强大很多。

---

### 区块选择

|按键|功能|
|v|字符选择，选择光标经过的地方|
|V|列选择，选择光标经过的的列|
|[Ctrl]+v|区块选择，以长方形选择区域来选择|
|y|复制已选择的字符|
|d|删除已选中的字符|
|p|将复制的字符粘贴到光标所在位置|

区块复制可以复制整个区块，并且保持区块中字符的相对位置不变，有时非常好用。

### 多文件编辑

|按键|功能|
|:n|编辑下一个文件|
|:N|编辑上一个文件|
|:files|列出目前vim打开的所有文件|

### 多窗口功能

输入`:sp <filename>`即可用另外一个窗口打开filename文件，filename可省略。

|按键|功能|
|:sp [*filename*]|打开新窗口，若加filename，则在新窗口打开新文件|
|[ctrl]+w+j<br>[ctrl]+w+↓|光标移动到下一个窗口|
|[ctrl]+w+k<br>[ctrl]+w+↑|光标移动到上一个窗口|
|[ctrl]+w+q|关闭当前窗口|

### 提示补全功能

|组合按键|功能|
|[ctrl]+x -> [ctrl]+n|以当前文件内容出现的词给予补全当前输入|
|[ctrl]+x -> [ctrl]+f|以当前文件夹内的文件名给予补全当前输入|
|[ctrl]+x -> [ctrl]+o|以当前文件使用的编程语言（根据扩展名确定）来补全当前输入|

### vim环境配置与记录

~/.viminfo会记录曾经使用的命令，可以在此文件查询


下表是vim的环境设置参数
|:set nu<br>:set nonu|设置与取消行号|
|:set hlsearch<br>:set nohlsearch|设置和取消高亮搜索|
|:set autoindent<br>:set noautoindent|设置和取消自动缩进|
|:set backup|设置储存备份文件，备份文件文件名为filename~|
|:set ruler|设置显示右下角的光标和行号等状态信息|
|:set showmode|设置显示当前编辑模式，是插入或是替换模式|
|:set backspace=(012)|设置退格，0或者1时仅能删除刚才输入的文件，不能删除原有文字，2时都可以删除|
|:set all|显示所有环境参数设置|
|:set|显示与系统默认值不同的设置|
|:syntax on<br>:syntax off|是否根据语法高亮文字|
|:set bg=dark<br>:set bg=light|显示颜色色调|

vimrc文件中，双引号"为注解的开始。启动时候设置的环境参数填入此文件。

---

## 其他vim注意事项

### 中文编码问题

如果使用vim打开中文文件乱码，需要从下面几个方向考虑：
1. Linux默认支持的语系数据，与/etc/locale.conf有关
2. 终端接口（bash）的语系，与LANG,LC_ALL变量有关
3. 文件原本的编码
4. 打开终端机的软件，如GNOME下的窗口接口

Linux的tty1~tty6窗口默认不支持中文编码

### Dos与Linux换行符

Dos使用的换行符为^M$，也就是CRLF，而Linux仅有LF（$）符号。

为了将文件从Dos的格式转换为Linux格式，可使用dos2unix和unix2dos命令，需要安装dos2unix软件

### 编码转换指令-iconv

格式：
- iconv --list
- iconv -f *原编码* -t *新编码* *filename* [-o *newfile*]

选项与参数：
- --list：列出iconv支持的预习
- -f：from，源编码格式
- -t：to，目标编码格式
- -o file：结果输出到file中

